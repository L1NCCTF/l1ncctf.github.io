<!doctype html><head><link rel=stylesheet href=https://l1ncctf.github.io/css/main.min.c55e8a3d90783e730dc058804a2726f26d7488162dd2f074752301ca9c1b8657.css></head><html lang=en><head><meta charset=utf-8><meta name=theme-color media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name=mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black-translucent"><meta name=viewport content="width=device-width,user-scalable=no,initial-scale=1,shrink-to-fit=no,viewport-fit=cover"><meta property="og:url" content="https://l1ncctf.github.io/post/heroctf-web-revoked/"><meta property="og:site_name" content="L1NC CTF"><meta property="og:title" content="HeroCTF 2025 - Revoked & Revoked Revenge"><meta property="og:description" content="Pair of web challenges featuring SQLi db enumeration and revoked JWT bypass."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-12-05T00:00:00+00:00"><meta property="article:modified_time" content="2025-12-05T00:00:00+00:00"><meta property="article:tag" content="HeroCTF"><meta property="article:tag" content="JWT"><meta property="article:tag" content="Flask"><meta property="article:tag" content="SQLi"><meta name=twitter:card content="summary"><meta name=twitter:title content="HeroCTF 2025 - Revoked & Revoked Revenge"><meta name=twitter:description content="Pair of web challenges featuring SQLi db enumeration and revoked JWT bypass."><meta itemprop=name content="HeroCTF 2025 - Revoked & Revoked Revenge"><meta itemprop=description content="Pair of web challenges featuring SQLi db enumeration and revoked JWT bypass."><meta itemprop=datePublished content="2025-12-05T00:00:00+00:00"><meta itemprop=dateModified content="2025-12-05T00:00:00+00:00"><meta itemprop=wordCount content="1739"><meta itemprop=keywords content="HeroCTF,JWT,Flask,SQLi"><title>HeroCTF 2025 - Revoked & Revoked Revenge |
L1NC CTF</title><link rel=apple-touch-icon sizes=180x180 href=/img/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicons/favicon-16x16.png><link rel="shortcut icon" href=/img/favicons/favicon.ico><meta name=apple-mobile-web-app-title content="L1NC CTF"><meta name=application-name content="L1NC CTF"><meta name=msapplication-TileColor content="#da532c"><meta name=msapplication-config content="/img/favicons/browserconfig.xml"><meta name=theme-color content="#ffffff"><link rel=preconnect href=https://fonts.googleapis.com><link rel=dns-prefetch href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=https://fonts.gstatic.com><link rel=preconnect href=https://cdn.jsdelivr.net><link rel=dns-prefetch href=https://cdn.jsdelivr.net><link rel=stylesheet href=https://l1ncctf.github.io/css/main.min.c55e8a3d90783e730dc058804a2726f26d7488162dd2f074752301ca9c1b8657.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&amp;family=Source+Sans+Pro:wght@400;600;700;900&amp;display=swap"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css><link rel=stylesheet href=/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css><script src=/js/modules/theme.js></script><script src=https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/dayjs@1.11.13/dayjs.min.js></script><script src=https://cdn.jsdelivr.net/npm/dayjs@1.11.13/locale/en.js></script><script src=https://cdn.jsdelivr.net/npm/dayjs@1.11.13/plugin/relativeTime.js></script><script src=https://cdn.jsdelivr.net/npm/dayjs@1.11.13/plugin/localizedFormat.js></script><script src=https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.js></script><script defer src=/js/post.js></script></head><body><aside aria-label=Sidebar id=sidebar class="d-flex flex-column align-items-end"><header class=profile-wrapper><a href=/ id=avatar class=rounded-circle><img src=/img/commons/l1nc.png width=112 height=112 alt=avatar onerror='this.style.display="none"'></a>
<a class="site-title d-block" href=/>L1NC CTF</a><p class="site-subtitle fst-italic mb-0">Be vigilant!</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class=nav><li class=nav-item><a href=/ class=nav-link><i class="fa-fw fas fa-house"></i>
<span>HOME</span></a></li><li class=nav-item><a href=/categories/ class=nav-link><i class="fa-fw fas fa-stream"></i>
<span>CATEGORIES</span></a></li><li class=nav-item><a href=/tags/ class=nav-link><i class="fa-fw fas fa-tags"></i>
<span>TAGS</span></a></li><li class=nav-item><a href=/archives/ class=nav-link><i class="fa-fw fas fa-archive"></i>
<span>ARCHIVES</span></a></li><li class=nav-item><a href=/about/ class=nav-link><i class="fa-fw fas fa-info-circle"></i>
<span>ABOUT</span></a></li><li class="nav-item mt-4"><a class="nav-link no-hover"><i class="fa-fw fas fa-language"></i><div class=lang-dropdown><select class=lang-select onchange="location=this.value"><option value=https://l1ncctf.github.io/en/ selected>English</option></select></div></a></li></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"><button type=button class="btn btn-link nav-link" aria-label="Switch Mode" id=mode-toggle>
<i class="fas fa-adjust"></i>
</button>
<span class=icon-border></span>
<a href=https://github.com/L1NCCTF aria-label=github target=_blank rel="noopener noreferrer"><i class="fab fa-github"></i>
</a><a href=https://twitter.com/L1NC_CTF aria-label=twitter target=_blank rel="noopener noreferrer"><i class="fab fa-x-twitter"></i>
</a><a href=https://l1ncctf.github.io/index.xml aria-label=rss><i class="fas fa-rss"></i></a></div></aside><div id=main-wrapper class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id=topbar-wrapper class=flex-shrink-0 aria-label="Top Bar"><div id=topbar class="d-flex align-items-center justify-content-between px-lg-3 h-100"><nav id=breadcrumb aria-label=Breadcrumb><span><a href=/>Home</a>
</span><span>HeroCTF 2025 - Revoked & Revoked Revenge</span></nav><button type=button id=sidebar-trigger class="btn btn-link" aria-label=Sidebar>
<i class="fas fa-bars fa-fw"></i></button><div id=topbar-title>HeroCTF 2025 - Revoked & Revoked Revenge</div><button type=button id=search-trigger class="btn btn-link" aria-label=Search>
<i class="fas fa-search fa-fw"></i>
</button>
<search id=search class="align-items-center ms-3 ms-lg-0"><i class="fas fa-search fa-fw"></i>
<input class=form-control id=search-input type=search aria-label=search autocomplete=off placeholder=Search...>
</search><button type=button class="btn btn-link text-decoration-none" id=search-cancel>Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class=px-1 data-toc=true><header><h1 data-toc-skip>HeroCTF 2025 - Revoked & Revoked Revenge</h1><p class="post-desc fw-light mb-4">Pair of web challenges featuring SQLi db enumeration and revoked JWT bypass.</p><div class="post-meta text-muted"><span>Posted
<time data-ts=1764892800 data-df=ll data-bs-toggle=tooltip data-bs-placement=bottom>%b %e, %Y</time></span><div class="d-flex justify-content-between"><span>By
<em><a href=https://tuxpad.github.io>TuxPad</a></em></span><div><span class=readtime data-bs-toggle=tooltip data-bs-placement=bottom title="2771 words"><em>15 min</em> read</span></div></div></div></header><div id=toc-bar class="d-flex align-items-center justify-content-between invisible"><span class="label text-truncate">HeroCTF 2025 - Revoked & Revoked Revenge</span>
<button type=button class="toc-trigger btn me-1">
<i class="fa-solid fa-list-ul fa-fw"></i></button></div><button id=toc-solo-trigger type=button class="toc-trigger btn btn-outline-secondary btn-sm">
<span class="label ps-2 pe-1">Contents</span>
<i class="fa-solid fa-angle-right fa-fw"></i>
</button>
<dialog id=toc-popup class=p-0><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">HeroCTF 2025 - Revoked & Revoked Revenge</div><button id=toc-popup-close type=button class="btn mx-1 my-1 opacity-75">
<i class="fas fa-close"></i></button></div><div id=toc-popup-content class="px-4 py-3 pb-4"><nav id=TableOfContents><ul><li><a href=#challenge-descriptions>Challenge Descriptions</a></li><li><a href=#revoked---black-box-solution>Revoked - Black Box Solution</a></li><li><a href=#revoked---white-box-solution>Revoked - White Box Solution</a><ul><li></li></ul></li><li><a href=#revoked-revenge---white-box-solution>Revoked Revenge - White Box Solution</a><ul><li></li></ul></li></ul></nav></div></dialog><div class=content><h2 id=challenge-descriptions id=challenge-descriptions><span class=me-2>Challenge Descriptions</span>
<a href=#challenge-descriptions class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><strong>Revoked:</strong>
<code>Your budget request for the new company personnel index has been declined. Instead, the intern has received a very small bonus in exchange for a homemade solution. Show them their stinginess could cost them.</code></p><p><strong>Revoked Revenge:</strong>
<code>The chall maker forgot to remove a debug account... Here is the revenge challenge without this backdoor!</code></p><p>Although <a href=https://github.com/HeroCTF/HeroCTF_v7/blob/master/Web/revoked/challenge/app/main.py>source code</a> for a Flask app was provided, I prefer starting with black‑box testing to understand how the application behaves externally before reviewing internals.
After solving the challenge through SQL injection, I went back to the source to analyze exactly why the exploit worked.</p><h2 id=revoked---black-box-solution id=revoked---black-box-solution><span class=me-2>Revoked - Black Box Solution</span>
<a href=#revoked---black-box-solution class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>When we enter the challenge we get a login screen with the option of registering a new user.
Trying a simple password <code>' OR 1=1;--</code> SQLi only returns &ldquo;Invalid credentials&rdquo;, so we&rsquo;ll register a new user.</p><p>Logging in with our new user brings us into an employee directory with a search bar, and in the top right corner is a drop-down for the logged in user.
Clicking our username reveals the option &ldquo;Admin panel&rdquo;, but clicking that returns " You don&rsquo;t have the permission to access this area".
<a href=/post/heroctf-web-revoked/no_access.png class="popup img-link"><img src=/post/heroctf-web-revoked/no_access.png alt=flag_1></a></p><p>Let&rsquo;s try to see if the search bar is vulnerable to SQLi by just entering a single quote.
It turns out that it indeed is vulnerable, and we get an internal server error.</p><a href=/post/heroctf-web-revoked/search_sqli.png class="popup img-link"><img src=/post/heroctf-web-revoked/search_sqli.png alt=search_sqli></a><p>So we&rsquo;ll start off by trying to get a UNION select query that will display properly and not result in an error.
We can discover how many columns the query returns by incrementally adding null values to the UNION SELECT until the query executes without errors.</p><p>Looking at the employee cards we can see that they display a photo, name, position, and a link,
so we&rsquo;ll try <code>' UNION SELECT null, null, null, null;--</code>, which returns an empty employee.
<a href=/post/heroctf-web-revoked/sqli_columns.png class="popup img-link"><img src=/post/heroctf-web-revoked/sqli_columns.png alt=sqli_columns></a></p><p>If we change the query to <code>'UNION SELECT 1,2,3,4;--</code> we can see which is which;</p><ul><li>The first value affects both the photo and the link, so it appears to be an id.</li><li>The second value is the employee name.</li><li>The third value is not shown.</li><li>The fourth value is the position.</li></ul><a href=/post/heroctf-web-revoked/sqli_positions.png class="popup img-link"><img src=/post/heroctf-web-revoked/sqli_positions.png alt=sqli_positions></a><p>Now we know that any values we want displayed should be in the second and fourth positions.</p><p>Knowing which type of database is used will help you knowing how to enumerate it, so that&rsquo;s a good place to start.
I&rsquo;m guessing that it&rsquo;s SQLite, so we can query the version to see:
<code>' UNION SELECT 1,sqlite_version(),3,4;--'</code>, which shows that it is indeed SQLite.</p><a href=/post/heroctf-web-revoked/sqlite_version.png class="popup img-link"><img src=/post/heroctf-web-revoked/sqlite_version.png alt=sqlite_version></a><p>Now that we know the type of database, we can enumerate the database tables:
<code>' UNION SELECT 1,2,3, tbl_name FROM sqlite_master WHERE type='table';--</code>
<a href=/post/heroctf-web-revoked/sqlite_tables.png class="popup img-link"><img src=/post/heroctf-web-revoked/sqlite_tables.png alt=sqlite_tables></a></p><p>Great! Now we know that there are four tables, and the ones that look interesting for us are users and revoked_tokens.
In order to dump the information we want we&rsquo;ll need to know the column names, which we can get by using the following query:
<code>' UNION SELECT 1,2,3, GROUP_CONCAT(name) AS column_names FROM pragma_table_info('users');--</code>
<a href=/post/heroctf-web-revoked/users_columns.png class="popup img-link"><img src=/post/heroctf-web-revoked/users_columns.png alt=users_columns></a></p><p>Now we can see that each entry has an id, a username, a &ldquo;is_admin&rdquo; variable, and a password hash.
This implies two ways to get the privileges we want; either we insert a value in is_admin to indicate that our user has admin privileges, or we dump and crack the admin hash.</p><p>Either way, we need to know the kind of value used.
<code>' UNION SELECT 1,username,3,is_admin FROM users;--</code>
<a href=/post/heroctf-web-revoked/is_admin_bool.png class="popup img-link"><img src=/post/heroctf-web-revoked/is_admin_bool.png alt=is_admin_bool></a></p><p>Now we can see that the app uses integers as booleans.</p><p>We could try to insert into the database, but SQLite3 (via Python) disallows multiple SQL statements per execute() call, so stacked queries are not possible, and because the base statement is a SELECT, the UNION injection is constrained to SELECT-only syntax. Therefore no INSERT/UPDATE/DELETE payload can be executed.</p><p>Instead we will dump password hashes, and we now know that we can filter for is_admin=1 to only get hashes for admin accounts.
<code>' UNION SELECT 1,password_hash,1,username FROM users WHERE is_admin=1--</code>
<a href=/post/heroctf-web-revoked/admin_hashes.png class="popup img-link"><img src=/post/heroctf-web-revoked/admin_hashes.png alt=admin_hashes></a></p><p>It seems that we have two admins, and we get their bcrypt hashes to attempt to crack.</p><p>Using hashcat mode 3200 with rockyou gives us <code>admin1:pass</code>.
(In a CTF where you&rsquo;re supposed to be able to crack the hash, rockyou is the standard wordlist)</p><p>We can now log in and access the admin panel for the flag.
<a href=/post/heroctf-web-revoked/revoked_flag.png class="popup img-link"><img src=/post/heroctf-web-revoked/revoked_flag.png alt=revoked_flag></a></p><h2 id=revoked---white-box-solution id=revoked---white-box-solution><span class=me-2>Revoked - White Box Solution</span>
<a href=#revoked---white-box-solution class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>We&rsquo;ve already solved the challenge, but let&rsquo;s have a look at why it works, and how we could&rsquo;ve figured it out by reviewing code.</p><p>From what we already know after black box testing, we will focus on:</p><ul><li>Login appears to not be vulnerable to SQLi</li><li>Employee search is vulnerable to SQLi</li></ul><p><strong>Login not vulnerable to SQLi</strong></p><p>We start off by having a look at the code for the login.</p><div class=code-block><div class=code-header><span data-label-text=Python><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>        <span class=n>user</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;SELECT * FROM users WHERE username = ?&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>username</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>user</span> <span class=ow>and</span> <span class=n>bcrypt</span><span class=o>.</span><span class=n>checkpw</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>password</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>),</span> <span class=n>user</span><span class=p>[</span><span class=s2>&#34;password_hash&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></div><p>Here we can see a textbook example of SQLi-safe code that has a prepared statement with parameterized queries.</p><p>The SQL statement is using a placeholder, <code>?</code>, and the username is inserted into a tuple and passed, along with the SQL statement to the database engine.
SQLite parses the statement and treats the placeholder as a bound parameter slot, and then the actual username is bound to that slot as raw data. Even if you try a SQLi like <code>admin' OR 1=1;--</code>, SQLite will see it as a literal string to match exactly against the username column and not treat it as SQL syntax.
SQLite automatically doubles single quotes in string literals, safely escaping SQLi attempts.</p><p>In addition to this, the password is not part of the query at all; if the user is found in the db, it is fetched and stored in the variable user, and the password entered is hashed and compared to the hash in the user variable.</p><p><strong>Emplyee search SQLi vulnerability</strong></p><p>The employee search, however, is a classic example of code that is vulnerable.</p><div class=code-block><div class=code-header><span data-label-text=Python><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=sa>f</span><span class=s2>&#34;SELECT id, name, email, position FROM employees WHERE name LIKE &#39;%</span><span class=si>{</span><span class=n>query</span><span class=si>}</span><span class=s2>%&#39;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span></span></span></code></pre></td></tr></table></div></div></div><p>Here we can see that the f-string directly interpolates the user input, which sent as a query to the database, meaning that the user input will be interpreted as SQL syntax, making it vulnerable to injection attacks.</p><p>Furthermore, as we can see the names of the database tables and columns both in the initialization, and in the queries, constructing a query to fetch the information we need becomes trivial.</p><h4 id=remediation id=remediation><span class=me-2>Remediation</span>
<a href=#remediation class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The search function should be rewritten in the same manner as the login, with a prepared statement and parameterized query.</p><h2 id=revoked-revenge---white-box-solution id=revoked-revenge---white-box-solution><span class=me-2>Revoked Revenge - White Box Solution</span>
<a href=#revoked-revenge---white-box-solution class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This challenge is using exactly the same code as the previous. The only difference is that the admin with a crackable password isn&rsquo;t there.
Thus we need to find another way in - and here we will focus on the revoked tokens.</p><p>When attacking tokens we could try to either:</p><ul><li>Find the secret used to sign them in order to forge our own token</li><li>Steal a token for impersonating a user.</li></ul><p>In the code can see that secret key used to sign tokens is made from 32 random hex characters.
So we can forget about cracking it to forge our own token.</p><div class=code-block><div class=code-header><span data-label-text=Python><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s2>&#34;SECRET_KEY&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>secrets</span><span class=o>.</span><span class=n>choice</span><span class=p>(</span><span class=s2>&#34;abcdef0123456789&#34;</span><span class=p>)</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></td></tr></table></div></div></div><p>But, the database is flushed at init.
This means that any revoked tokens in the database have been made using the current secret.</p><div class=code-block><div class=code-header><span data-label-text=Python><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>init_db</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span> <span class=o>=</span> <span class=n>sqlite3</span><span class=o>.</span><span class=n>connect</span><span class=p>(</span><span class=s2>&#34;database.db&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>cursor</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;DROP TABLE IF EXISTS employees;&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;DROP TABLE IF EXISTS revoked_tokens;&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;DROP TABLE IF EXISTS users;&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS users (
</span></span></span><span class=line><span class=cl><span class=s2>                        id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=s2>                        username TEXT UNIQUE NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>                        is_admin BOOL NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>                        password_hash TEXT NOT NULL)&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS revoked_tokens (
</span></span></span><span class=line><span class=cl><span class=s2>                        id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=s2>                        token TEXT NOT NULL)&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>cursor</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span><span class=s2>&#34;&#34;&#34;CREATE TABLE IF NOT EXISTS employees (
</span></span></span><span class=line><span class=cl><span class=s2>                        id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span></span><span class=line><span class=cl><span class=s2>                        name TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>                        email TEXT UNIQUE NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>                        position TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>                        phone TEXT NOT NULL,
</span></span></span><span class=line><span class=cl><span class=s2>                        location TEXT NOT NULL)&#34;&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>commit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>conn</span><span class=o>.</span><span class=n>close</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div></div><p>As we saw previously, the employee search is vulnerable to SQLi, letting us dump revoked tokens from the database.
<code>' UNION SELECT 1,2,3,token FROM revoked_tokens;--</code></p><a href=/post/heroctf-web-revoked/revoked_tokens.png class="popup img-link"><img src=/post/heroctf-web-revoked/revoked_tokens.png alt=revoked_tokens></a><p>Decoding the first token shows us that this is the admins token, that&rsquo;s the one we&rsquo;ll use.</p><div class=code-block><div class=code-header><span data-label-text=JSON><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;username&#34;</span><span class=p>:</span> <span class=s2>&#34;admin&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;is_admin&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;issued&#34;</span><span class=p>:</span> <span class=mf>1764771147.1933315</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div><p>The vulnerability we will exploit can be found in this part of the code:</p><div class=code-block><div class=code-header><span data-label-text=Python><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>revoked</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;SELECT id FROM revoked_tokens WHERE token = ?&#34;</span><span class=p>,</span> <span class=p>(</span><span class=n>token</span><span class=p>,)</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div></div><p>This bit of code compares the exact string of the tokens in the revoked_tokens table with the token submitted by the user.</p><p>So why is this a problem?
The answer to this is that JWT are encoded in Base64url, which omits the <code>=</code> padding found in regular Base64.
And the problem here is that the PyJWT Base64url decoder is permissive: it accepts both padded and unpadded variants of the same JWT payload/signature.</p><p>So when the tokens are generated, they lack padding, and this is how they are stored in the database when they are revoked.
If we add padding in the form of <code>=</code>, or even <code>==</code>, to the end of a token, the PyJWT decoder will still be able to successfully decode it as the same token, but in the check against the revoked tokens it will no longer be a match.</p><p>Thus, we now have a valid token that bypasses the revocation check and can impersonate the admin user.
<a href=/post/heroctf-web-revoked/valid_token.png class="popup img-link"><img src=/post/heroctf-web-revoked/valid_token.png alt=valid_token>
</a><a href=/post/heroctf-web-revoked/revenge_flag.png class="popup img-link"><img src=/post/heroctf-web-revoked/revenge_flag.png alt=revenge_flag></a></p><h4 id=remediation-1 id=remediation-1><span class=me-2>Remediation</span>
<a href=#remediation-1 class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>This vulnerability can be fixed by simply stripping padding from the token submitted by the user before comparing to the revoked tokens.
Padding variations do not change the decoded JWT payload or signature, but they do change the raw string representation used in the SQL lookup.</p><div class=code-block><div class=code-header><span data-label-text=Python><i class="fas fa-code fa-fw small"></i></span> <button aria-label=copy data-title-succeed=Copied!><i class="far fa-clipboard"></i></button></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>normalized_token</span> <span class=o>=</span> <span class=n>token</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s1>&#39;=&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>revoked</span> <span class=o>=</span> <span class=n>conn</span><span class=o>.</span><span class=n>execute</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;SELECT id FROM revoked_tokens WHERE token = ?&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=n>normalized_token</span><span class=p>,)</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=o>.</span><span class=n>fetchone</span><span class=p>()</span></span></span></code></pre></td></tr></table></div></div></div><p>As the code is now, this remediates the problem; the tokens generated by PyJWT don&rsquo;t have padding and will be inserted as such.
But, even though it is redundant, it&rsquo;s considered best practice to also strip the tokens inserted at logout, because we don&rsquo;t know how the code will be modified in the future, and adding this helps keeping the app secure.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"><i class="far fa-folder-open fa-fw me-1"></i>
<a href=/categories/writeups/>Writeups</a>
,
<a href=/categories/writeups/web/>Web</a></div><div class=post-tags><i class="fa fa-tags fa-fw me-1"></i>
<a href=/tags/heroctf/ class="post-tag no-text-decoration">HeroCTF</a>
<a href=/tags/jwt/ class="post-tag no-text-decoration">JWT</a>
<a href=/tags/flask/ class="post-tag no-text-decoration">Flask</a>
<a href=/tags/sqli/ class="post-tag no-text-decoration">SQLi</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2"><div class=license-wrapper>This post is licensed under <a href=https://creativecommons.org/licenses/by/4.0/>CC BY 4.0</a> by the author.</div></div></div></article></main><aside aria-label=Panel id=panel-wrapper class="col-xl-3 ps-2 text-muted"><div class=access><section id=access-lastmod><h2 class=panel-heading>Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"><a href=/post/heroctf-web-revoked/>HeroCTF 2025 - Revoked & Revoked Revenge</a></li><li class="text-truncate lh-lg"><a href=/post/o24-forensic-ghost_in_the_wall/>O24 CTF 2024 - Ghost In The Wall</a></li><li class="text-truncate lh-lg"><a href=/post/hsctf9-crypto-otp/>HSCTF 9 - OTP</a></li><li class="text-truncate lh-lg"><a href=/post/hsctf9-crypto-baby_baby_rsa/>HSCTF 9 - Baby-baby-rsa</a></li><li class="text-truncate lh-lg"><a href=/post/hsctf9-crypto-quagmire_i/>HSCTF 9 - Quagmire-I</a></li></ul></section><section><h2 class=panel-heading>Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"><a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/crypto/>crypto</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/flask/>flask</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/heroctf/>heroctf</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/hsctf/>hsctf</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/jwt/>jwt</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/linux/>linux</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/pcap/>pcap</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/privesc/>privesc</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/quagmire/>quagmire</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/rsa/>rsa</a></div></section></div><div class="toc-border-cover z-3"></div><section id=toc-wrapper class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id=toc></nav></section></aside></div><div class=row><div id=tail-wrapper class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id=related-posts aria-labelledby=related-label><h3 class=mb-4 id=related-label>Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class=col><a href=/post/hsctf9-web-gallery/ class="post-preview card h-100"><div class=card-body><time data-ts=1652140800 data-df=ll>%b %e, %Y</time><h4 class="pt-0 my-2">HSCTF 9 - Gallery</h4><div class=text-muted><p>A simple web challenge involving directory traversal. &amp;lt;span class=&amp;quot;me-2&amp;quot;&amp;gt;Description&amp;lt;/span&amp;gt; &amp;lt;a href=&amp;quot;#description&amp;quot; class=&amp;quot;anchor text-muted&amp;quot;&amp;gt;&amp;lt;i …</p></div></div></a></article><article class=col><a href=/post/hsctf9-crypto-quagmire_i/ class="post-preview card h-100"><div class=card-body><time data-ts=1655078400 data-df=ll>%b %e, %Y</time><h4 class="pt-0 my-2">HSCTF 9 - Quagmire-I</h4><div class=text-muted><p>Easy crypto that can be solved manually. &amp;lt;span class=&amp;quot;me-2&amp;quot;&amp;gt;Description&amp;lt;/span&amp;gt; &amp;lt;a href=&amp;quot;#description&amp;quot; class=&amp;quot;anchor text-muted&amp;quot;&amp;gt;&amp;lt;i class=&amp;quot;fas …</p></div></div></a></article><article class=col><a href=/post/hsctf9-crypto-otp/ class="post-preview card h-100"><div class=card-body><time data-ts=1655164800 data-df=ll>%b %e, %Y</time><h4 class="pt-0 my-2">HSCTF 9 - OTP</h4><div class=text-muted><p>Poorly generated random number that allows for a small range to check &amp;lt;span class=&amp;quot;me-2&amp;quot;&amp;gt;Description&amp;lt;/span&amp;gt; &amp;lt;a href=&amp;quot;#description&amp;quot; class=&amp;quot;anchor …</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"><a href=/post/o24-forensic-ghost_in_the_wall/ class="btn btn-outline-primary" aria-label=Older><p>O24 CTF 2024 - Ghost In The Wall</p></a><div class="btn btn-outline-primary disabled" aria-label=Newer><p>-</p></div></nav><footer aria-label="Site Info" class="d-flex flex-column justify-content-center text-muted
flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3"><p>©
<time>2026</time>
<a href=https://github.com/orgs/L1NCCTF>L1NC</a>.
<span data-bs-toggle=tooltip data-bs-placement=top title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p><p>Using the <a data-bs-toggle=tooltip data-bs-placement=top title=v1.0.2 href=https://github.com/geekifan/hugo-theme-chirpy target=_blank rel=noopener>Chirpy</a> theme for <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>.</p></footer></div></div><div id=search-result-wrapper class="d-flex justify-content-center d-none"><div class="col-11 content"><div id=search-hints><section><h2 class=panel-heading>Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"><a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/crypto/>crypto</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/flask/>flask</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/heroctf/>heroctf</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/hsctf/>hsctf</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/jwt/>jwt</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/linux/>linux</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/pcap/>pcap</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/privesc/>privesc</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/quagmire/>quagmire</a>
<a class="post-tag btn btn-outline-primary" href=https://l1ncctf.github.io/tags/rsa/>rsa</a></div></section></div><div id=search-results class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div><script>const DEFAULT_CONFIG={search:{minChars:1,maxResults:5,fields:{title:!0,description:!0,section:!0,contents:!0},strictMode:!0}};class FastSearch{constructor({searchInput:e,resultsContainer:t,json:n,searchResultTemplate:s=null,noResultsText:o=null}){this.searchInput=e,this.resultsContainer=t,this.json=n,this.searchResultTemplate=s,this.noResultsText=o,this.init()}init(){this.loadSearchIndex(),this.searchInput.addEventListener("input",e=>{if(!this.searchIndex){this.resultsContainer.innerHTML='<li class="search-message">Loading search index...</li>';return}this.performSearch(this.searchInput.value)})}async loadSearchIndex(){try{const e=await fetch(this.json);if(!e.ok)throw new Error("Failed to load search index");const t=await e.json();this.searchIndex=t.map(e=>({...e,searchableTitle:e.title?.toLowerCase()||"",searchableDesc:e.desc?.toLowerCase()||"",searchableSection:e.section?.toLowerCase()||"",searchableContents:e.contents?.toLowerCase()||""}))}catch(e){console.error("Error loading search index:",e),this.resultsContainer.innerHTML='<li class="search-message">Error loading search index...</li>'}}escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""}containsTerm(e,t){return!!e&&!!t&&e.includes(t)}performSearch(e){if(e=e.toLowerCase().trim(),!e||!this.searchIndex||e.length<DEFAULT_CONFIG.search.minChars){this.resultsContainer.innerHTML="";return}const s=[e,...e.split(/\s+/).filter(e=>e.length>0)],t=[...new Set(s)],o=DEFAULT_CONFIG.search.strictMode,n=this.searchIndex.map(e=>{const s=this.checkFieldsForMatch(e,t[0]);if(o&&!s)return{item:e,score:0,matched:!1};let n=0,i=0,a=!1;t.forEach((t,s)=>{const r=s===0,o=this.checkFieldsForMatch(e,t);o&&(i++,o.inTitle&&(n+=r?10:5,a=!0),o.inDesc&&(n+=r?8:4),o.inSection&&(n+=r?6:3),o.inContents&&(n+=r?4:2))});const r=i/t.length,c=n*r*(a?1.5:1);return{item:e,score:c,matched:s}}).filter(e=>e.matched).sort((e,t)=>t.score-e.score).slice(0,DEFAULT_CONFIG.search.maxResults).map(e=>e.item);if(n.length===0){this.resultsContainer.innerHTML='<p class="mt-5">Oops! No results found.</p>';return}const i=n.map(e=>{let t="",n="";return e.categories&&(t=e.categories.join(", "),t=`<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${t}</div>`),e.tags&&(n=e.tags.join(", "),n=`<div><i class="fa fa-tag fa-fw"></i>${n}</div>`),`
        <article class="px-1 px-sm-2 px-lg-4 px-xl-0">
          <header>
            <h2><a href="${this.escapeHtml(e.permalink)}">${this.escapeHtml(e.title)}</a></h2>
            <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">
              ${t}
              ${n}
            </div>
          </header>
          <p>${this.escapeHtml(e.contents)}</p>
        </article>
      `}).join("");this.resultsContainer.innerHTML=i}checkFieldsForMatch(e,t){const n={inTitle:!1,inDesc:!1,inSection:!1,inContents:!1};return DEFAULT_CONFIG.search.fields.title&&this.containsTerm(e.searchableTitle,t)&&(n.inTitle=!0),DEFAULT_CONFIG.search.fields.description&&this.containsTerm(e.searchableDesc,t)&&(n.inDesc=!0),DEFAULT_CONFIG.search.fields.section&&this.containsTerm(e.searchableSection,t)&&(n.inSection=!0),DEFAULT_CONFIG.search.fields.contents&&this.containsTerm(e.searchableContents,t)&&(n.inContents=!0),!!(n.inTitle||n.inDesc||n.inSection||n.inContents)&&n}}const search=new FastSearch({searchInput:document.getElementById("search-input"),resultsContainer:document.getElementById("search-results"),json:`/index.json`})</script></div><aside aria-label="Scroll to Top"><button id=back-to-top type=button class="btn btn-lg btn-box-shadow">
<i class="fas fa-angle-up"></i></button></aside></div><div id=mask class="d-none position-fixed w-100 h-100 z-1"></div></body></html>